---
layout: post

title: åŸºäºDocker+Jenkins+githubçš„æŒç»­é›†æˆå¼€å‘åå°å®è·µ

date: 2017-03-02 16:32:24.000000000 +09:00

---

## æŒç»­é›†æˆå¼€å‘

+ æ£€æµ‹PRä»£ç  ->ç¼–è¯‘->å•å…ƒæµ‹è¯•->Review->Merge->æ‰“åŒ…->ä¸Šä¼ é•œåƒåˆ°DockerHub-> åœ¨æµ‹è¯•ç¯å¢ƒæµ‹è¯• -> æ­£å¼ç¯å¢ƒä¸Šçº¿ä¸‹è½½é•œåƒ
+ TODOï¼šå¥åº·æ£€æŸ¥->ç¦æ­¢ä¸šåŠ¡æµé‡->åœæ­¢åº”ç”¨->æ›´æ–°åº”ç”¨->å¯åŠ¨åº”ç”¨->å¼€å¯ä¸šåŠ¡æµé‡ ï¼ˆæ”¯æŒçƒ­éƒ¨ç½²ï¼Œå›æ»šï¼‰æ·»åŠ ğŸ¤–ï¸ ChatOps ï¼š ç›‘æµ‹PR é“¾æ¥Stackæé†’æäº¤è¢«æ‹’
+ [BearyChat + GitHub + Hubot + Jenkins](https://blog.shonenada.com/post/chatops/)
+ [Home + buildbot + git-pylint-commit-hook + Docker](https://www.linuxzen.com/python-github-si-you-xiang-mu-tong-guo-buildbot-jin-xing-review.html)
+ [Jenkins iosçš„ CI](http://duchengjiu.iteye.com/blog/2169857)
+ [å‚è€ƒ](https://www.jerrylou.me/docker/deploy-auto-platform-20161109.html)

## å¦‚æœå¼€å¯Jenkinsæ—¶æ£€æµ‹8080ç«¯å£ è¢«å ç”¨

ç”¨ä¸‹é¢å‘½ä»¤æŸ¥çœ‹å ç”¨8080çš„è¿›ç¨‹å¹¶æ€æ‰ã€‚
sudo lsof -i :8080
kill 1011
é çš„ æœ‰å®ˆæŠ¤è¿›ç¨‹ï¼Œç›´æ¥å¸è½½æ‰Jenkins
/Library/Application Support/Jenkins/Uninstall.command
åˆ‡æ¢jenkinsçš„é»˜è®¤ç«¯å£
sudo defaults write /Library/Preferences/org.jenkins-ci httpPort 7070
å†é‡å¯jenkins

## å¼€å¯Jenkins å¹¶åŠ è½½å¤‡ä»½é…ç½®æ•°æ®å·

```
docker run --name myjenkins -p 8080:8080 -p 50000:50000 -v ~/jenkins_home:/var/jenkins_home  -it myjenkins:v4
å¤‡ä»½æ—¶çš„å‘½ä»¤ä¸º
sudo docker cp e52a5e7fe510:~/jenkins_home /var
ï¼ï¼sudo docker cp ./id_rsa e52a5e7fe510:/id_rsa
```

## ç›‘å¬ä»£ç 

æœ‰å…¬ç½‘æ¡ä»¶ï¼šåœ¨gité¡¹ç›®ä¸­çš„settingçš„webhooks å¡«å…¥ jenkinsçš„â€œjobâ€çš„â€œé…ç½®â€ä¸­çš„â€œæ„å»ºè§¦å‘å™¨â€çš„â€œè§¦å‘è¿œç¨‹æ„å»ºâ€æ‹¼æ¥çš„tokenã€‚
æ²¡æœ‰å…¬ç½‘æ¡ä»¶ï¼šå°±åœ¨jenkins çš„â€œjobâ€çš„â€œé…ç½®â€ä¸­çš„â€œæ„å»ºè§¦å‘å™¨â€çš„â€œPoll SCMâ€ ä¸­ å¡«å…¥ â€œ */1 * * * * â€ æ¯åˆ†é’Ÿæ£€æŸ¥æ›´æ–°ä¸€æ¬¡ã€‚
http://www.cnblogs.com/yjmyzz/p/jenkins-tutorial-part-1.html


## Jenkins ç¼–è¯‘goé¡¹ç›® shell è„šæœ¬

```
export GOPATH=$WORKSPACE
export PATH=$PATH:$GOPATH/bin
export GOROOT=/usr/lib/go
export GOBIN=$GOPATH/bin
cd $WORKSPACE
go install ./src/github.com/callmebill/todolist/main.go
docker build -t goodjob:v1 .
```

## é‚®ä»¶é€šçŸ¥é…ç½®

è¦åœ¨ç³»ç»Ÿè®¾ç½®ä¸­å¡«å¥½ â€œç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€â€ å’Œ â€œé‚®ä»¶é€šçŸ¥â€ ä¸¤è€…è¦ä¿æŒä¸€è‡´ï¼Œå®‰è£…Email Extersion Pluginæ’ä»¶åéœ€è¦å¡«å†™ Extended E-mail Notification é…ç½®ä¸€äº›å…¨å±€å˜é‡ä¾›ç»™ jobä¸­æ„å»ºåçš„æ“ä½œé…ç½®ä½¿ç”¨ã€‚

## Golang çš„æµ‹è¯•è¦†ç›–ç‡

```
go test -cover -coverprofile myapp.out
go tool cover -html=myapp.out -o myapp.html
```

## é¦–å…ˆç®€å•è®²è®²å…¬é’¥éªŒè¯æœºåˆ¶ï¼š

å…¬é’¥å’Œå¯†é’¥æ˜¯ä¸¤ä»½æ–‡ä»¶ï¼ŒæœåŠ¡ç«¯æŒæœ‰å…¬é’¥ï¼Œç”¨æ¥åŠ å¯†ï¼›å®¢æˆ·ç«¯æŒæœ‰å¯†é’¥ï¼Œç”¨æ¥è§£å¯†ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¿æ¥è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šç”Ÿæˆä¸€ä¸²éšæœºæ•°ï¼Œç»è¿‡å…¬é’¥åŠ å¯†åä¼ ç»™å®¢æˆ·ç«¯ã€‚è¿™æ—¶å®¢æˆ·ç«¯ä¼šç”¨å¯†é’¥è§£å¯†è·å–éšæœºæ•°ï¼Œå†è¿”å›æœåŠ¡ç«¯ã€‚æœ€åæœåŠ¡ç«¯åˆ¤æ–­ä¸€ä¸‹ï¼Œå¦‚æœå®¢æˆ·ç«¯èƒ½å¤Ÿè¿”å›æ­£ç¡®çš„éšæœºæ•°ï¼Œå°±è®¤ä¸ºæ ¡éªŒé€šè¿‡äº† ï¼Œå¯ä»¥è¿›è¡Œè¿æ¥ã€‚å¦åˆ™æ‚¨å°±ä»å“ªå„¿æ¥ä¼šå“ªå„¿å»å§ã€‚

- ssh-keygen -t rsa

## å‘½ä»¤è¡Œ å¸¸ç”¨å‘½ä»¤ï¼š

lsof -i:8888  æŸ¥çœ‹ç›‘å¬8888ç«¯å£çš„è¿›ç¨‹
kill 517  æ€æ‰æŒ‡å®šè¿›ç¨‹
linux æ‰“å°æœ¬æœºå¤–ç½‘IPå‘½ä»¤ ï¼š curl ifconfig.me
contianer ipaddress :  docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' e52a5e7fe510
catå‘½ä»¤ ï¼š cat > huang_id_rsa << EOF

## Pull request builder pluginçš„é…ç½®

http://www.cnblogs.com/zanjiahaoge666/p/6402738.html

## Jenkinsä¸Šæ‰§è¡Œçš„è¿œç¨‹é‡å¯æœåŠ¡å™¨çš„è„šæœ¬ï¼š

```
export GOPATH=/Users/leeco/Desktop/GoWorkSpace
IMAGE_NAME='todo-image'
CONTAINER_NAME="todo-container"
cd $GOPATH/src/github.com/callmebill/todolist
docker build -t  $IMAGE_NAME  .
docker stop $CONTAINER_NAME
docker rm $CONTAINER_NAME
docker run --name $CONTAINER_NAME -p 8888:8888 -i $IMAGE_NAME >/dev/null 2>&1 &
```